<!DOCTYPE html>
<html lang="nl">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Inlogpagina - Werkvergunning Portaal</title>
        <link rel="stylesheet" href="CSS/style.css">
    </head>
    <body>
        <div class="login-container">
            <div class="login-card">
                <div class="icon-container">
                    <i class="far fa-file-lines"></i>
                </div>
                <h1>Werkvergunning Portaal</h1>
                <p class="subtitle">Log in om uw werkvergunning aan te vragen</p>
                
                <form class="login-form" id="loginForm">
                    <div class="form-group">
                        <label for="role">Rol selecteren</label>
                        <div class="select-wrapper">
                            <select id="role" name="role" required>
                                <option value="">Selecteer een rol</option>
                                <option value="leerling">Leerling/Externe</option>
                                <option value="leerkracht">Leerkracht</option>
                                <option value="ta">TA</option>
                                <option value="directeur">Directeur</option>
                            </select>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                    <!-- 
                    kan je de volgorde en buttons fixen, de volgorde is: vak1, vak2, vak2 activiteit, vak2 chemicalen, vak3, vak4, vak5, preventie, loto, vak6, vak7, eindresultaat en dan nog 2 buttons vorige en volgende, als je op volgende klikt slaagt alles op en ga je terug naar de overzicht pagina als het geen waarmee je oorspronkelijk bent ingelogd, kan je ook op de overzicht pagina zelf voor elke gebruiker de navigatie balk veranderen naar links als hamburgermenu (alleen met de buttons, de rest moet hetzelfde blijven), zorg dat deze nieuwe navigatie balk niks veranderd in de oorspronkelijke layout, ook wil ik dat de onderste knop om een aanvraag te starten verwijderd moet worden op elke gebruikers pagina
                    -->
                    <div class="form-group">
                        <label for="email">E-mailadres</label>
                        <input type="email" id="email" name="email" placeholder="naam@voorbeeld.be" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Wachtwoord</label>
                        <input type="password" id="password" name="password" placeholder="••••••••" required>
                    </div>
                    
                    <div class="form-options">
                        <a href="#" class="forgot-password">Wachtwoord vergeten?</a>
                    </div>
                    
                    <button type="submit" class="login-button">Inloggen</button>
                </form>
                
                <div class="demo-info">
                    <p>Demo: Gebruik elk e-mailadres en een wachtwoord van minimaal 6 tekens</p>
                    <p>Selecteer uw rol om de juiste interface te zien</p>
                </div>
            </div>
            
            <div class="logo-card">
                <img src="IMAGES/logo-beveren.jpg" alt="Beveren Logo" class="beveren-logo">
            </div>
        </div>
        
        <script src="https://kit.fontawesome.com/fec428329f.js" crossorigin="anonymous"></script>
        <script>
            // DEMO-WACHTWOORDEN PER ROL:
            // Leerling/Externe  -> leerling123
            // Leerkracht        -> leerkracht123
            // TA                -> ta123
            // Directeur         -> directeur123   

            const ROLE_PAGES = {
                'leerling': 'HTML/overzicht_leerling.html',
                'leerkracht': 'HTML/overzicht_leerkracht.html',
                'ta': 'HTML/overzicht_ta.html',
                'directeur': 'HTML/overzicht_directeur.html'
            };

            const ROLE_MASTER_PASSWORDS = {
                'leerling': 'leerling123',
                'leerkracht': 'leerkracht123',
                'ta': 'ta123',
                'directeur': 'directeur123'
            };

            function loadUsersDb() {
                try {
                    return JSON.parse(localStorage.getItem('users_db') || '{}');
                } catch {
                    return {};
                }
            }

            function saveUsersDb(db) {
                localStorage.setItem('users_db', JSON.stringify(db));
            }

            function loadLoginHistory() {
                try {
                    return JSON.parse(localStorage.getItem('login_history') || '[]');
                } catch {
                    return [];
                }
            }

            function saveLoginHistory(history) {
                localStorage.setItem('login_history', JSON.stringify(history));
            }

            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const role = document.getElementById('role').value;
                const email = document.getElementById('email').value.trim().toLowerCase();
                const password = document.getElementById('password').value;

                if (!role) {
                    alert('Selecteer alstublieft een rol');
                    return;
                }

                if (!email) {
                    alert('Vul een e-mailadres in');
                    return;
                }

                if (password.length < 4) {
                    alert('Wachtwoord moet minimaal 4 tekens lang zijn');
                    return;
                }

                const master = ROLE_MASTER_PASSWORDS[role];
                if (!master) {
                    alert('Onbekende rol.');
                    return;
                }

                let db = loadUsersDb();

                // Controleer of dit e-mailadres al voor een andere rol bestaat
                const existingUser = Object.values(db).find(u => u.email === email);
                if (existingUser && existingUser.role !== role) {
                    alert('Deze gebruikersnaam is al in gebruik voor een andere rol.');
                    return;
                }

                // Gebruiker bestaat al
                if (db[email]) {
                    if (db[email].password !== password) {
                        alert('Onjuist wachtwoord voor deze gebruikersnaam.');
                        return;
                    }
                } else {
                    // Eerste login: wachtwoord moet gelijk zijn aan rol-wachtwoord
                    if (password !== master) {
                        alert('Onjuist wachtwoord voor deze rol.');
                        return;
                    }
                    db[email] = {
                        email,
                        role,
                        password,
                        createdAt: new Date().toISOString()
                    };
                    saveUsersDb(db);
                }

                // Loginhistoriek bijwerken
                const history = loadLoginHistory();
                history.push({
                    email,
                    role,
                    loginAt: new Date().toISOString()
                });
                saveLoginHistory(history);

                // Store role in sessionStorage for later use
                sessionStorage.setItem('userRole', role);
                sessionStorage.setItem('userEmail', email);

                // Redirect to overview page based on role
                const target = ROLE_PAGES[role] || 'HTML/overzicht_leerling.html';
                window.location.href = target;
            });
        </script>
    </body>
    <!--- scripts --->
    <script src="https://kit.fontawesome.com/fec428329f.js" crossorigin="anonymous"></script>
</html>